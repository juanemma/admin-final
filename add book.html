<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add Book - Admin</title>
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    margin: 0;
    padding: 0;
}

.container {
    max-width: 600px;
    margin: 50px auto;
    background-color: white;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
}

h2 {
    text-align: center;
    margin-bottom: 20px;
}

form label {
    display: block;
    margin: 15px 0 5px;
    font-weight: bold;
}

form input[type="text"],
form textarea,
form input[type="file"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
    border: 1px solid #ccc;
    box-sizing: border-box;
}

form textarea {
    resize: vertical;
    height: 100px;
}

form button {
    background-color: rgb(0, 104, 0);
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    width: 100%;
    margin-top: 10px;
}

form button:hover {
    background-color: darkgreen;
}

.book-list {
    max-width: 800px;
    margin: 30px auto;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.book-item {
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
}

.book-item img {
    width: 120px;
    height: 160px;
    object-fit: cover;
    margin-bottom: 10px;
    border-radius: 6px;
}

.book-item h4 {
    margin: 5px 0;
}

.book-item button {
    margin: 5px;
    padding: 5px 10px;
    cursor: pointer;
    border: none;
    border-radius: 4px;
    color: white;
}

.update-btn { background-color: orange; }
.delete-btn { background-color: red; }
</style>
</head>
<body>

<div class="container">
    <h2>Add a New Book</h2>
    <form id="addBookForm" enctype="multipart/form-data">
        <label for="title">Book Title:</label>
        <input type="text" id="title" name="title" placeholder="Enter book title" required>

        <label for="author">Author:</label>
        <input type="text" id="author" name="author" placeholder="Enter author name" required>

        <label for="description">Description:</label>
        <textarea id="description" name="description" placeholder="Enter book description" required></textarea>

        <label for="cover">Cover Image:</label>
        <input type="file" id="cover" name="cover" accept="image/*" required>

        <label for="file">Book File (PDF/Other):</label>
        <input type="file" id="file" name="file" accept=".pdf,.doc,.docx,.txt">

        <label for="category">Category/Genre:</label>
        <input type="text" id="category" name="category" placeholder="e.g. IT, Fiction">

        <button type="submit">Add Book</button>
    </form>
</div>

<div class="book-list" id="bookList"></div>

<script>
// Initialize books from localStorage or empty array
let books = JSON.parse(localStorage.getItem("books")) || [];

// Display books
function displayBooks() {
    const list = document.getElementById("bookList");
    list.innerHTML = "";

    books.forEach((book, index) => {
        const div = document.createElement("div");
        div.className = "book-item";
        div.innerHTML = `
            <img src="${book.cover}" alt="${book.title}">
            <h4>${book.title}</h4>
            <p><b>Author:</b> ${book.author}</p>
            <p><b>Category:</b> ${book.category}</p>
            <button class="update-btn" onclick="editBook(${index})">Update</button>
            <button class="delete-btn" onclick="deleteBook(${index})">Delete</button>
        `;
        list.appendChild(div);
    });
}

// Add new book
const form = document.getElementById('addBookForm');
form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const title = document.getElementById('title').value.trim();
    const author = document.getElementById('author').value.trim();
    const description = document.getElementById('description').value.trim();
    const category = document.getElementById('category').value.trim();

    const coverFile = document.getElementById('cover').files[0];
    const bookFile = document.getElementById('file').files[0];

    if (!coverFile) {
        alert("Cover image is required!");
        return;
    }

    const cover = await fileToBase64(coverFile);
    let fileData = "";
    if (bookFile) fileData = await fileToBase64(bookFile);

    const newBook = { title, author, description, category, cover, file: fileData };
    books.push(newBook);
    localStorage.setItem("books", JSON.stringify(books));

    form.reset();
    displayBooks();
});

// Convert file to Base64 string
function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });
}

// Delete book
function deleteBook(index) {
    if (confirm("Are you sure you want to delete this book?")) {
        books.splice(index, 1);
        localStorage.setItem("books", JSON.stringify(books));
        displayBooks();
    }
}

// Update book
function editBook(index) {
    const book = books[index];
    document.getElementById('title').value = book.title;
    document.getElementById('author').value = book.author;
    document.getElementById('description').value = book.description;
    document.getElementById('category').value = book.category;

    // Remove the book first, will be added again on submit
    books.splice(index, 1);
    localStorage.setItem("books", JSON.stringify(books));
    displayBooks();
}

// Display books on load
displayBooks();
</script>

</body>
</html>
